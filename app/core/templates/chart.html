{% extends 'base.html' %}
{% load render_table from django_tables2 %}
{% block title %}
  {% if title %}
  {{ title }}
  {% else %}
  Make Queries
  {% endif %}
{% endblock %}
{% block content %}

<ul id="querytype_nav" style="display: flex; flex-flow: row; justify-content: space-around;">
	<li><a href={% url 'profit' month=currentMonth id=currentID %}>Profits</a></li>
  <li><a href={% url 'numsold' month=currentMonth id=currentID %}>Amount Sold</a></li>
</ul>
<ul id="timeslice_nav" style="display: flex; flex-flow: row; justify-content: space-around;">
  {% if amt %}
	  <li><a href={% url 'numsold' month=3 id=currentID %}>03 Months</a></li>
    <li><a href={% url 'numsold' month=12 id=currentID %}>12 Months</a></li>
    <li><a href={% url 'numsold' month=60 id=currentID %}>60 Months</a></li>
  {% else %}
    <li><a href={% url 'profit' month=3 id=currentID %}>03 Months</a></li>
    <li><a href={% url 'profit' month=12 id=currentID %}>12 Months</a></li>
    <li><a href={% url 'profit' month=60 id=currentID %}>60 Months</a></li>
  {% endif %}
</ul>

<div style="
  display: flex;
  flex-flow: row;
">
<ul style="float : left; width : 20%;">
  {% if amt %}
    {% for product in products %}
      <li><a href={% url 'numsold' month=currentMonth id=product.id %}>{{ product.productName }}</a></li>
    {% endfor %}
  {% else %}
    {% for product in products %}
      <li><a href={% url 'profit' month=currentMonth id=product.id %}>{{ product.productName }}</a></li>
    {% endfor %}
  {% endif %}
</ul>

<div id='section2' style="display: flex; flex-flow: column; width:90%;">
<canvas id="myChart"></canvas>

{% if title %}
  <p>
    {% if data %}
      {% if amt %}
        {{ amt }} sold
      {% elif profit %}
        Made ${{ profit }}
      {% endif %}
      in the past {{ currentMonth }} months.
    {% else %}
        There are no entries in the {{title}} Query.
    {% endif %}
  </p>
{% else %}
    <p>This is where you can see the Queries</p>
{% endif %}
</div>
</div>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
  <script>
    const ctx = document.getElementById('myChart');

    var myChart = new Chart(ctx, {
      type: 'line',
      options: {
        scales: {
          xAxes: [{
            type: 'time',
          }],
          yAxes: [{
            min : 0,
            ticks : {
              min : 0
          }
          }],
        }
      },
      data: {
        labels: [
        {% for row in data %}
        '{{ row.t }}',
        {% endfor %}
        ],
        datasets: [{
          lineTension: .1,
          label: '{{ chartlabel }}',
          data: [
          {% for row in data %}
          { t : '{{ row.t }}', y : {{row.y}} },
          {% endfor %}
          ],
          backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)'
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
          ],
          borderWidth: 1
        }]
      }
    });
  </script>
{% endblock %}